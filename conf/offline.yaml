# Controller configuration with multiple workers
controller:
  log_level: INFO # Log level for the controller itself
  log_file: "/tmp/vanishcap.log" # Optional: Path to log file
  offline: true # Whether to run in offline mode (no WiFi management)
  wifi:
    connect:
      ssid: "t1" # Optional: SSID to connect to before starting workers
      password: "" # Optional: Password for the SSID
    reconnect: true # Optional: Whether to reconnect to previous SSID after workers finish

video:
  name: "video"
  source: "/tmp/vanishcap_recording.mp4" # Tello video stream
  log_level: INFO # Show frame acquisition info
  profile_window: 1.0 # Show max task time over last second
  depends_on: ["detector", "drone"] # Wait for detector and drone to start

detector:
  name: "detector"
  model: yolov8m
  model_verbose: true
  backend: tensorrt
  frame_skip: 1 # Process every frame
  log_level: INFO # Show frame processing info
  profile_window: 2.0 # Show max task time over last 2 seconds
  depends_on: [] # No dependencies
  events:
    - video: frame # Receive frame events from video

navigator:
  name: "navigator"
  disabled: false
  target_class: "person" # Track people (class name)
  log_level: INFO
  profile_window: 1.5 # Show max task time over last 1.5 seconds
  depends_on: ["detector"] # Wait for detector to start
  events:
    - detector: detection # Receive detection events from detector

drone:
  name: "drone"
  disabled: false
  log_level: INFO
  profile_window: 1.0 # Show max task time over last second
  depends_on: ["navigator"] # Wait for navigator to start
  events:
    - navigator: target # Receive target events from navigator
  driver:
    log_level: INFO
    name: "offline" # Name of the driver to use
    max_linear_velocity: 50 # Maximum linear velocity in cm/s
    max_angular_velocity: 50 # Maximum angular velocity in deg/s
    max_vertical_velocity: 30 # Maximum vertical velocity in cm/s
    field_of_view: 82.6 # Width of camera field of view in degrees for time-based yaw control
    disable_yaw: false # Whether to disable yaw rotation
    disable_xy: false # Whether to disable forward/backward and left/right movement
    disable_z: false # Whether to disable up/down movement
  follow_distance: 100 # Distance to maintain from target in cm
  follow_target_width: 0.5 # Width of target to maintain in proportion of frame width
  follow_target_height: 0.75 # Where on the target's height to center (default: 0.85)
  movement_threshold: 0.1 # In normalized coordinates [-1, 1]
  delay_between_timed_yaws: 0.1 # Delay between timed yaws in seconds
  percent_angle_to_command: 50 # Percentage of target angle to rotate in each yaw command [0, 100]
  auto_takeoff: true # Whether to take off automatically without waiting for a target

ui:
  name: "ui"
  disabled: false
  log_level: INFO # Show frame display info
  profile_window: 1.0 # Show max task time over last second
  depends_on: [] # No dependencies, can start anytime
  events:
    - video: frame # Receive frame events from video
    - detector: detection # Receive detection events from detector
    - video: worker_profile # Receive profiling data from video worker
    - detector: worker_profile # Receive profiling data from detector worker
    - navigator: worker_profile # Receive profiling data from navigator worker
    - ui: worker_profile # Receive profiling data from UI worker
